<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>STT-TTS Library Consumer Sample</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        margin: 0;
        padding: 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
      }
      h1 {
        color: white;
        margin-bottom: 0.5rem;
      }
      .subtitle {
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 2rem;
      }
      .card {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      }
      .card h2 {
        margin-top: 0;
        color: #333;
      }
      textarea,
      input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: monospace;
        font-size: 14px;
        margin: 0.5rem 0;
      }
      textarea {
        resize: vertical;
        min-height: 100px;
      }
      .button-group {
        display: flex;
        gap: 10px;
        margin: 1.5rem 0;
        flex-wrap: wrap;
      }
      button {
        flex: 1;
        min-width: 120px;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }
      .btn-secondary {
        background: #f0f0f0;
        color: #333;
        border: 1px solid #ddd;
      }
      .btn-secondary:hover {
        background: #e8e8e8;
      }
      .btn-danger {
        background: #ff6b6b;
        color: white;
      }
      .btn-danger:hover {
        background: #ff5252;
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .log {
        background: #f5f5f5;
        padding: 12px;
        border-radius: 8px;
        max-height: 300px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 13px;
        line-height: 1.5;
      }
      .log-entry {
        padding: 2px 0;
      }
      .log-entry.info {
        color: #1976d2;
      }
      .log-entry.success {
        color: #388e3c;
      }
      .log-entry.error {
        color: #d32f2f;
      }
      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 10px;
      }
      .status-badge.ready {
        background: #e8f5e9;
        color: #388e3c;
      }
      .status-badge.not-ready {
        background: #ffebee;
        color: #d32f2f;
      }
      .tabs {
        display: flex;
        gap: 5px;
        margin-bottom: 1rem;
        border-bottom: 2px solid #ddd;
      }
      .tab-btn {
        padding: 10px 20px;
        border: none;
        background: none;
        cursor: pointer;
        font-weight: 600;
        color: #999;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
      }
      .tab-btn.active {
        color: #667eea;
        border-bottom-color: #667eea;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üì¶ STT-TTS Library Consumer Sample</h1>
      <p class="subtitle">
        Demonstrating how to use stt-tts-lib-0.1.0.tgz in your projects
      </p>

      <!-- Tabs -->
      <div class="card">
        <div class="tabs">
          <button class="tab-btn" onclick="switchTab('sts')">
            üó£Ô∏è Speech-to-Speech
          </button>
          <button class="tab-btn active" onclick="switchTab('stt')">
            Speech-to-Text
          </button>
          <button class="tab-btn" onclick="switchTab('tts')">
            Text-to-Speech
          </button>
          <button class="tab-btn" onclick="switchTab('info')">
            Library Info
          </button>
        </div>

        <!-- STS Tab -->
        <div id="sts-tab" class="tab-content">
          <h2>üó£Ô∏è Speech-to-Speech Demo</h2>
          <p style="color: #666; margin-bottom: 1rem">
            Full voice conversation: Speak ‚Üí LLM processes ‚Üí AI responds with
            voice
          </p>

          <label>LLM API Configuration:</label>
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 10px;
              margin-bottom: 1rem;
            "
          >
            <input
              type="text"
              id="stsApiUrl"
              placeholder="API URL (e.g., https://api.openai.com/v1/chat/completions)"
              value="https://api.openai.com/v1/chat/completions"
            />
            <input
              type="password"
              id="stsApiKey"
              placeholder="API Key"
              value="<%= process.env.OPENAI_SECRET_KEY || '' %>"
            />
          </div>
          <input
            type="text"
            id="stsModel"
            placeholder="Model (e.g., gpt-4o-mini)"
            value="gpt-4o-mini"
            style="margin-bottom: 1rem"
          />

          <label>Voice ID:</label>
          <input
            type="text"
            id="stsVoiceId"
            value="en_US-hfc_female-medium"
            placeholder="TTS Voice ID"
          />

          <div class="button-group">
            <button class="btn-secondary" onclick="initSTS()" id="initStsBtn">
              Initialize STS
            </button>
          </div>

          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 1rem;
              margin: 1rem 0;
            "
          >
            <div>
              <label>üé§ Your Speech:</label>
              <textarea
                id="stsUserTranscript"
                readonly
                placeholder="Speak and your words appear here..."
                style="min-height: 120px"
              ></textarea>
            </div>
            <div>
              <label>ü§ñ AI Response:</label>
              <textarea
                id="stsAiResponse"
                readonly
                placeholder="AI response will appear here..."
                style="min-height: 120px"
              ></textarea>
            </div>
          </div>

          <div class="button-group">
            <button
              class="btn-primary"
              onclick="startSTS()"
              id="startStsBtn"
              disabled
            >
              üéôÔ∏è Start Conversation
            </button>
            <button
              class="btn-danger"
              onclick="stopSTS()"
              id="stopStsBtn"
              disabled
            >
              ‚èπÔ∏è Stop
            </button>
          </div>

          <div
            id="stsStatus"
            style="
              padding: 12px;
              background: #f5f5f5;
              border-radius: 8px;
              margin-top: 1rem;
              text-align: center;
            "
          >
            <span style="color: #666">Status: Not initialized</span>
          </div>

          <div
            style="
              margin-top: 1rem;
              padding: 12px;
              background: #fff3e0;
              border-radius: 8px;
              font-size: 13px;
            "
          >
            <strong>üí° How it works:</strong><br />
            1. Click "Start Conversation" and speak<br />
            2. When you pause, your speech is sent to the LLM<br />
            3. LLM response is automatically spoken back to you<br />
            4. Continue the conversation naturally!
          </div>
        </div>

        <!-- STT Tab -->
        <div id="stt-tab" class="tab-content active">
          <h2>üé§ Speech-to-Text Demo</h2>

          <div class="button-group">
            <button class="btn-primary" onclick="startSTT()" id="startSttBtn">
              Start Listening
            </button>
            <button
              class="btn-danger"
              onclick="stopSTT()"
              id="stopSttBtn"
              disabled
            >
              Stop Listening
            </button>
          </div>

          <label>Transcript:</label>
          <textarea
            id="transcript"
            readonly
            placeholder="Your speech will appear here..."
          ></textarea>

          <label>Heard Words:</label>
          <div
            id="heardWords"
            style="
              padding: 12px;
              background: #f5f5f5;
              border-radius: 8px;
              min-height: 40px;
            "
          >
            <em>No words yet</em>
          </div>
        </div>

        <!-- TTS Tab -->
        <div id="tts-tab" class="tab-content">
          <h2>üîä Text-to-Speech Demo</h2>

          <label>Voice ID:</label>
          <input
            type="text"
            id="modelPath"
            value="en_US-hfc_female-medium"
            placeholder="e.g., en_US-hfc_female-medium, en_US-lessac-medium"
          />

          <div class="button-group">
            <button class="btn-secondary" onclick="initTTS()">
              Initialize TTS
            </button>
          </div>

          <label
            >Text to synthesize (multiple sentences for streaming demo):</label
          >
          <textarea
            id="ttsText"
            placeholder="Enter text to convert to speech..."
          >
Hello and welcome to this advanced audio streaming demonstration where the goal is to clearly showcase how queued speech synthesis can significantly improve the listening experience for users who expect fast and natural feedback from a system, while the very first segment of speech begins playing immediately without waiting for the entire content to finish processing. Meanwhile, the remaining portions of the text continue to be synthesized in parallel across the system pipeline so that by the time the listener reaches the next pause, the following audio is already prepared and ready to play without any noticeable delay or interruption in flow. This approach greatly reduces perceived latency and makes long spoken responses feel smooth, responsive, and much more conversational, especially in real time interactive applications.</textarea
          >

          <div class="button-group">
            <button
              class="btn-primary"
              onclick="synthesizeText()"
              id="synthesizeBtn"
              disabled
            >
              Stream Synthesize & Play
            </button>
            <button class="btn-danger" onclick="stopAudio()">
              Stop & Clear Queue
            </button>
          </div>

          <div
            style="
              margin-top: 1rem;
              padding: 12px;
              background: #e3f2fd;
              border-radius: 8px;
              font-size: 13px;
            "
          >
            <strong>üí° How it works:</strong> Text is split by punctuation into
            sentences. Each sentence is synthesized and immediately added to the
            audio queue. With <code>autoPlay: true</code>, playback starts as
            soon as the first sentence is ready ‚Äî no waiting for full synthesis!
          </div>
        </div>

        <!-- Info Tab -->
        <div id="info-tab" class="tab-content">
          <h2>üìö Library Information</h2>

          <h3>Installation</h3>
          <pre
            style="
              background: #f5f5f5;
              padding: 12px;
              border-radius: 8px;
              overflow-x: auto;
            "
          >
npm install ./stt-tts-lib-0.1.0.tgz</pre
          >

          <h3>Available Exports</h3>
          <h4>STT (Speech-to-Text)</h4>
          <ul>
            <li><code>ResetSTTLogic</code> - Auto-restart STT logic</li>
            <li><code>STTLogic</code> - Basic STT logic</li>
            <li><code>VADController</code> - Voice Activity Detection</li>
          </ul>

          <h4>TTS (Text-to-Speech)</h4>
          <ul>
            <li><code>PiperSynthesizer</code> - ONNX-based speech synthesis</li>
            <li><code>AudioPlayer</code> - Audio playback controller</li>
            <li><code>preparePiperVoice</code> - Voice preparation utility</li>
            <li><code>streamTokensToSpeech</code> - Streaming TTS</li>
            <li><code>useStreamingTTS</code> - React hook for TTS</li>
          </ul>

          <h3>Usage Examples</h3>
          <pre
            style="
              background: #f5f5f5;
              padding: 12px;
              border-radius: 8px;
              overflow-x: auto;
            "
          >
// Import from main entry
import { ResetSTTLogic, PiperSynthesizer } from 'stt-tts-lib';

// Or import from submodules
import { ResetSTTLogic } from 'stt-tts-lib/stt';
import { PiperSynthesizer } from 'stt-tts-lib/tts';</pre
          >
        </div>
      </div>

      <!-- Logs -->
      <div class="card">
        <h2>üìä Logs</h2>
        <div class="log" id="log"></div>
        <div class="button-group">
          <button class="btn-secondary" onclick="clearLog()">Clear Log</button>
        </div>
      </div>
    </div>

    <script type="module" src="/main.js"></script>

    <script>
      function switchTab(tabName) {
        // Hide all tabs
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });
        document.querySelectorAll(".tab-btn").forEach((btn) => {
          btn.classList.remove("active");
        });

        // Show selected tab
        const tabId = `${tabName}-tab`;
        document.getElementById(tabId).classList.add("active");
        event.target.classList.add("active");
      }
    </script>
  </body>
</html>
